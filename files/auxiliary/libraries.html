<!DOCTYPE html><html><head><meta charset="utf-8"><title>Libraries and functions - Auxiliary Docs | Factorio</title><link href="https://cdn.factorio.com/assets/fonts/titillium-web.css" rel="stylesheet"><link href="https://cdn.factorio.com/assets/fonts/roboto-mono.css" rel="stylesheet"><link href="../style.css?v=72ae9920" rel="stylesheet" type="text/css"><meta name="viewport" content="width=device-width"><link rel="shortcut icon" href="../static/favicon.png"><script src="../script.js?v=72ae9920"></script></head><body class="docs docs-wide"><div id="top" class="top-bar mb32"><div class="top-bar-inner"><div class="sites links flex flex-items-baseline" style="width: 100%"><span><a href="https://factorio.com" style="color: #7dcaed;">Factorio.com</a><span class="separator">|</span><a href="https://forums.factorio.com/" style="color: #7dcaed;">Forums</a><span class="separator">|</span><a href="https://wiki.factorio.com/" style="color: #7dcaed;">Wiki</a><span class="separator">|</span><a href="https://mods.factorio.com" style="color: #7dcaed;">Mod Portal</a><span class="separator">|</span><a href="../index.html" class="sites-current">API Docs</a></span><span style="margin-left: auto;"><a href="../index-prototype.html">Prototype</a><span class="separator">|</span><a href="../index-runtime.html">Runtime</a><span class="separator">|</span><a href="../index-auxiliary.html" class="sites-current">Auxiliary</a></span></div></div></div><div class="container"><div class="container-inner"><div id="auxiliary-page"></div> <h1 class="ml8 mr8" style="position: relative;"><a href="../index-auxiliary.html" style="color: #ffe6c0;">Factorio Auxiliary Docs</a><a href="/" class="version-link" style="color: #ffe6c0;"><span class="version-string">Version</span> 2.0.55 <img src="../static/collapse-symbol.png" class="collapse-icon"></a></h1><div id="docs-layout-panel" class="panel flex-column pb0 overflow-unset"><div class="flex flex-reverse docs-panes " style="margin-top: -12px;"><div class="docs-content flex flex-column"><div class="panel-inset breadcrumbs mb0 p4"><span class="breadcrumbs-text"><a href="../index-auxiliary.html">Home</a> / <a href="libraries.html">Libraries and functions</a></span><a id="page-width-button" class="button square-sm" style="float: right;">&gt;&lt;</a></div><div class="panel-inset-lighter" style="flex-grow: 1;"><h2 id="libraries-and-functions">Libraries and functions<a class="ml8 link" href="#libraries-and-functions"><img src="../static/link-symbol.png"></a></h2><p>Factorio adds several functions and libraries to the Lua environment that cannot be found in standard <a href="https://www.lua.org/manual/5.2/">Lua 5.2.1</a>. Furthermore, it modifies several functions to be deterministic, notably <code>pairs()</code> and <code>math.random()</code>.</p><hr><h3 id="libraries">Libraries<a class="ml8 link" href="#libraries"><img src="../static/link-symbol.png"></a></h3><h4 id="•-serpent">• serpent<a class="ml8 link" href="#•-serpent"><img src="../static/link-symbol.png"></a></h4><p>Factorio provides the <a href="https://github.com/pkulchenko/serpent">serpent library</a> as a global variable named <code>serpent</code> for all mods to use. Its purpose is to allow for easy printing of Lua tables (using <code>serpent.block()</code> for example), which can be useful when debugging. It can't pretty-print LuaObjects such as <a href="../classes/LuaEntity.html">LuaEntity</a> however.</p><p>The serpent library was modified for determinism, e.g. comments are turned off by default to avoid returning table addresses. Furthermore, two options were added: <code>refcomment</code> (true/false/maxlevel) and <code>tablecomment</code> (true/false/maxlevel), which allow to separately control the self-reference and table value output of the <code>comment</code> option.</p><h4 id="•-string">• string<a class="ml8 link" href="#•-string"><img src="../static/link-symbol.png"></a></h4><p>The <code>string</code> library has the functions <code>pack</code>, <code>packsize</code> and <code>unpack</code> backported from <a href="https://www.lua.org/manual/5.4/">Lua 5.4.6</a> for handling <a href="https://www.lua.org/manual/5.4/manual.html#6.4.2">binary structure format strings</a>.</p><hr><h3 id="new-functions">New functions<a class="ml8 link" href="#new-functions"><img src="../static/link-symbol.png"></a></h3><h4>• log(LocalisedString) </h4><p><code>log()</code> can print <a href="../concepts/LocalisedString.html">LocalisedStrings</a> to the Factorio <a href="https://wiki.factorio.com/Log_file">log file</a>. This, in combination with the serpent library, makes debugging in the data stage easier because it allows the inspection of entire prototype tables. For example, printing all properties of the sulfur item prototype can be done like so: <code>log(serpent.block(data.raw["item"]["sulfur"]))</code></p><h4>• localised_print(LocalisedString) </h4><p><code>localised_print()</code> allows printing <a href="../concepts/LocalisedString.html">LocalisedString</a> to stdout without polluting the Factorio <a href="https://wiki.factorio.com/Log_file">log file</a>. This is primarily useful when communicating with external tools that launch Factorio as a child process.</p><h4>• table_size(table) →&nbsp;uint </h4><p>Factorio provides the <code>table_size()</code> function as a simple way to determine the size of tables with non-continuous keys, as the standard <code>#</code> operator does not work correctly for these. The function is a C++ implementation of the following Lua code, which is faster than doing the same in Lua:</p><div class="codehilite" style="background: #263238"><pre style="line-height: 125%;"><span></span><code><span style="color: #BB80B3">local</span><span style="color: #EFF"> </span><span style="color: #BB80B3">function</span><span style="color: #EFF"> </span><span style="color: #82AAFF">size</span><span style="color: #89DDFF">(t)</span>
<span style="color: #EFF">  </span><span style="color: #BB80B3">local</span><span style="color: #EFF"> </span><span style="color: #89DDFF">count</span><span style="color: #EFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EFF"> </span><span style="color: #F78C6C">0</span>
<span style="color: #EFF">  </span><span style="color: #BB80B3">for</span><span style="color: #EFF"> </span><span style="color: #89DDFF">k,v</span><span style="color: #EFF"> </span><span style="color: #BB80B3">in</span><span style="color: #EFF"> </span><span style="color: #82AAFF">pairs</span><span style="color: #89DDFF">(t)</span><span style="color: #EFF"> </span><span style="color: #BB80B3">do</span>
<span style="color: #EFF">    </span><span style="color: #89DDFF">count</span><span style="color: #EFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EFF"> </span><span style="color: #89DDFF">count</span><span style="color: #EFF"> </span><span style="color: #89DDFF">+</span><span style="color: #EFF"> </span><span style="color: #F78C6C">1</span>
<span style="color: #EFF">  </span><span style="color: #BB80B3">end</span>
<span style="color: #EFF">  </span><span style="color: #BB80B3">return</span><span style="color: #EFF"> </span><span style="color: #89DDFF">count</span>
<span style="color: #BB80B3">end</span>
</code></pre></div><p>Note that <code>table_size()</code> does not work correctly for <a href="../classes/LuaCustomTable.html">LuaCustomTable</a>, their size has to be determined with <a href="../classes/LuaCustomTable.html#length_operator">LuaCustomTable::length_operator</a> instead.</p><hr><h3 id="modified-functions">Modified functions<a class="ml8 link" href="#modified-functions"><img src="../static/link-symbol.png"></a></h3><p>Some modules that are part of standard Lua are not accessible in Factorio's Lua environment, mostly to ensure determinism. These inaccessible modules are: <code>loadfile()</code>, <code>dofile()</code>, <code>coroutine</code>, <code>io</code> and <code>os</code>. Factorio provides its own versions of <code>package</code> and <code>debug</code>.</p><h4 id="•-pairs()-/-next()">• pairs() / next()<a class="ml8 link" href="#•-pairs()-/-next()"><img src="../static/link-symbol.png"></a></h4><p>In standard Lua, the order of iteration when using <code>pairs()</code> is arbitrary. Because Factorio has to be deterministic, this was changed in Factorio's version of Lua. Factorio's iteration order when using <code>next()</code> (which <code>pairs()</code> uses for iteration) depends on the insertion order: Keys inserted first are iterated first.</p><p>Factorio however also guarantees that the first 1024 numbered keys are iterated from 1 to 1024, regardless of insertion order. This means that for common uses, <code>pairs()</code> does not have any drawbacks compared to <code>ipairs()</code>.</p><h4 id="•-require()">• require()<a class="ml8 link" href="#•-require()"><img src="../static/link-symbol.png"></a></h4><p>Due to the changes to <code>package</code>, the functionality of <code>require()</code> changes. When using absolute paths, the path starts at the mod root. Additionally, <code>..</code> is disabled as a path variable. This means that it is not possible to load arbitrary files from outside the mod directory.</p><p>Factorio does however provide two ways to load files from other mods:</p><ul><li>The "lualib" directory of the core mod is included in the paths to be checked for files, so it is possible to require files directly from there, such as the "util" file by using <code>require("util")</code>.</li><li>Furthermore, it is possible to require files from other mods by using <code>require("__mod-name__.file")</code>.</li></ul><p><code>require()</code> can not be used in the console, in event listeners or during a <code>remote.call()</code>. The function expects any file to end with the <code>.lua</code> extension.</p><h4 id="•-print()">• print()<a class="ml8 link" href="#•-print()"><img src="../static/link-symbol.png"></a></h4><p><code>print()</code> outputs to stdout. For Factorio, this means that it does not end up in the log file, so it can only be read when starting Factorio from the command line. Because of this, it is often easier to use <code>log()</code> or <a href="../classes/LuaGameScript.html#print">LuaGameScript::print</a> for debugging.</p><h4 id="•-math.random()">• math.random()<a class="ml8 link" href="#•-math.random()"><img src="../static/link-symbol.png"></a></h4><p><code>math.random()</code> is reimplemented within Factorio to be deterministic, both in the data stage and during runtime.</p><p>In the data stage, it is seeded with a constant number. During runtime, it uses the map's global random generator which is seeded with the map seed. The map's global random generator is shared between all mods and the core game, which all affect the random number that is generated. If this behaviour is not desired, <a href="../classes/LuaRandomGenerator.html">LuaRandomGenerator</a> can be used to create a random generator that is completely separate from the core game and other mods.</p><p>This method can't be used outside of events or during loading. Calling it with non-integer arguments will floor them instead of resulting in an error.</p><h4 id="•-math.randomseed()">• math.randomseed()<a class="ml8 link" href="#•-math.randomseed()"><img src="../static/link-symbol.png"></a></h4><p>Using <code>math.randomseed()</code> in Factorio has no effect on the random generator, the function does nothing. If custom seeding or re-seeding is desired, <a href="../classes/LuaRandomGenerator.html">LuaRandomGenerator</a> can be used instead of <code>math.random()</code>.</p><h4 id="•-load()">• load()<a class="ml8 link" href="#•-load()"><img src="../static/link-symbol.png"></a></h4><p><code>load()</code> will not load binary chunks; the <code>mode</code> argument has no effect.</p><h4 id="•-debug">• debug<a class="ml8 link" href="#•-debug"><img src="../static/link-symbol.png"></a></h4><p>In the <code>debug</code> module, only <code>debug.getinfo()</code> and <code>debug.traceback()</code> are available by default. For advanced debug use, access to the potentially unsafe functions in the rest of the standard Lua debug module can be re-enabled with a command line option.</p><h4 id="•-debug.getinfo()">• debug.getinfo()<a class="ml8 link" href="#•-debug.getinfo()"><img src="../static/link-symbol.png"></a></h4><p><code>debug.getinfo()</code> supports an additional flag <code>p</code> which fills in <code>currentpc</code> with the index of the current instruction within the function at the given stack level, or <code>-1</code> for functions not on the call stack. All standard fields are also supported.</p><h4 id="•-mathematical-functions">• Mathematical functions<a class="ml8 link" href="#•-mathematical-functions"><img src="../static/link-symbol.png"></a></h4><p>All trigonometric, hyperbolic, exponential and logarithmic Lua functions have been replaced by custom implementations to ensure determinism across platforms. For standard uses, they behave equivalently.</p></div></div><div class="docs-sidebar mr12 flex-column fs0"><div class="panel-inset breadcrumbs mb0 p4"><span class="breadcrumbs-text"><a href="../defines.html" class="category-link" data-view="list-defines">Defines</a></span><a id="hide-sidebar-button" class="button square-sm" style="float: right;">|&lt;</a></div><div class="panel-inset mb0 fs0 p4 flex"><input id="ref-search" type="text" class="w100p" placeholder="Search..." spellcheck="false"></div><div id="docs-sidebar-list" class="panel-inset-lighter mt0 p2 docs-sidebar-list h100"><h2 class="ml8 mt8 mb0 yellow">General Topics</h2><ul class="panel-hole" id="list-general"><li data-name="Data Lifecycle"><a href="data-lifecycle.html">Data Lifecycle</a><li data-name="Storage"><a href="storage.html">Storage</a><li data-name="Migrations"><a href="migrations.html">Migrations</a><li data-name="Libraries"><a href="libraries.html" class="white strong">Libraries</a><li data-name="Prototype Inheritance Tree"><a href="prototype-tree.html">Prototype Inheritance Tree</a><li data-name="Noise Expressions"><a href="noise-expressions.html">Noise Expressions</a><li data-name="Instrument Mode"><a href="instrument.html">Instrument Mode</a><li data-name="Item Weight"><a href="item-weight.html">Item Weight</a></ul><h2 class="ml8 mt8 mb0 yellow">JSON Docs</h2><ul class="panel-hole" id="list-json"><li data-name="Runtime JSON Format"><a href="json-docs-runtime.html">Runtime JSON Format</a><li data-name="Prototype JSON Format"><a href="json-docs-prototype.html">Prototype JSON Format</a></ul><p><h2 class="ml8 mt8 mb0 yellow"><a class="collapse-link not-selectable" data-view="list-defines" data-collapsed="false"><img src="../static/collapse-symbol.png" class="collapse-icon" style="pointer-events: none;"><img src="../static/expand-symbol.png" class="expand-icon" style="pointer-events: none; display: none;"></a><a href="../defines.html"> Defines</a></h2><ul class="panel-hole" id="list-defines"><li data-name="alert_type"><a href="../defines.html#defines.alert_type">alert_type</a><li data-name="behavior_result"><a href="../defines.html#defines.behavior_result">behavior_result</a><li data-name="build_check_type"><a href="../defines.html#defines.build_check_type">build_check_type</a><li data-name="build_mode"><a href="../defines.html#defines.build_mode">build_mode</a><li data-name="cargo_destination"><a href="../defines.html#defines.cargo_destination">cargo_destination</a><li data-name="chain_signal_state"><a href="../defines.html#defines.chain_signal_state">chain_signal_state</a><li data-name="chunk_generated_status"><a href="../defines.html#defines.chunk_generated_status">chunk_generated_status</a><li data-name="command"><a href="../defines.html#defines.command">command</a><li data-name="compound_command"><a href="../defines.html#defines.compound_command">compound_command</a><li data-name="control_behavior"><a href="../defines.html#defines.control_behavior">control_behavior</a><li data-name="controllers"><a href="../defines.html#defines.controllers">controllers</a><li data-name="deconstruction_item"><a href="../defines.html#defines.deconstruction_item">deconstruction_item</a><li data-name="default_icon_size"><a href="../defines.html#defines.default_icon_size">default_icon_size</a><li data-name="difficulty"><a href="../defines.html#defines.difficulty">difficulty</a><li data-name="direction"><a href="../defines.html#defines.direction">direction</a><li data-name="disconnect_reason"><a href="../defines.html#defines.disconnect_reason">disconnect_reason</a><li data-name="distraction"><a href="../defines.html#defines.distraction">distraction</a><li data-name="entity_status"><a href="../defines.html#defines.entity_status">entity_status</a><li data-name="entity_status_diode"><a href="../defines.html#defines.entity_status_diode">entity_status_diode</a><li data-name="events"><a href="../defines.html#defines.events">events</a><li data-name="flow_precision_index"><a href="../defines.html#defines.flow_precision_index">flow_precision_index</a><li data-name="game_controller_interaction"><a href="../defines.html#defines.game_controller_interaction">game_controller_interaction</a><li data-name="group_state"><a href="../defines.html#defines.group_state">group_state</a><li data-name="gui_type"><a href="../defines.html#defines.gui_type">gui_type</a><li data-name="input_action"><a href="../defines.html#defines.input_action">input_action</a><li data-name="input_method"><a href="../defines.html#defines.input_method">input_method</a><li data-name="inventory"><a href="../defines.html#defines.inventory">inventory</a><li data-name="logistic_member_index"><a href="../defines.html#defines.logistic_member_index">logistic_member_index</a><li data-name="logistic_mode"><a href="../defines.html#defines.logistic_mode">logistic_mode</a><li data-name="logistic_section_type"><a href="../defines.html#defines.logistic_section_type">logistic_section_type</a><li data-name="mouse_button_type"><a href="../defines.html#defines.mouse_button_type">mouse_button_type</a><li data-name="moving_state"><a href="../defines.html#defines.moving_state">moving_state</a><li data-name="print_skip"><a href="../defines.html#defines.print_skip">print_skip</a><li data-name="print_sound"><a href="../defines.html#defines.print_sound">print_sound</a><li data-name="prototypes"><a href="../defines.html#defines.prototypes">prototypes</a><li data-name="rail_connection_direction"><a href="../defines.html#defines.rail_connection_direction">rail_connection_direction</a><li data-name="rail_direction"><a href="../defines.html#defines.rail_direction">rail_direction</a><li data-name="rail_layer"><a href="../defines.html#defines.rail_layer">rail_layer</a><li data-name="relative_gui_position"><a href="../defines.html#defines.relative_gui_position">relative_gui_position</a><li data-name="relative_gui_type"><a href="../defines.html#defines.relative_gui_type">relative_gui_type</a><li data-name="render_mode"><a href="../defines.html#defines.render_mode">render_mode</a><li data-name="rich_text_setting"><a href="../defines.html#defines.rich_text_setting">rich_text_setting</a><li data-name="riding"><a href="../defines.html#defines.riding">riding</a><li data-name="robot_order_type"><a href="../defines.html#defines.robot_order_type">robot_order_type</a><li data-name="rocket_silo_status"><a href="../defines.html#defines.rocket_silo_status">rocket_silo_status</a><li data-name="selection_mode"><a href="../defines.html#defines.selection_mode">selection_mode</a><li data-name="shooting"><a href="../defines.html#defines.shooting">shooting</a><li data-name="signal_state"><a href="../defines.html#defines.signal_state">signal_state</a><li data-name="space_platform_state"><a href="../defines.html#defines.space_platform_state">space_platform_state</a><li data-name="target_type"><a href="../defines.html#defines.target_type">target_type</a><li data-name="train_state"><a href="../defines.html#defines.train_state">train_state</a><li data-name="transport_line"><a href="../defines.html#defines.transport_line">transport_line</a><li data-name="wire_connector_id"><a href="../defines.html#defines.wire_connector_id">wire_connector_id</a><li data-name="wire_origin"><a href="../defines.html#defines.wire_origin">wire_origin</a><li data-name="wire_type"><a href="../defines.html#defines.wire_type">wire_type</a></ul></div></div><div class="docs-sidebar-thin mr8 flex-column" style="margin-top: 20px;"><a id="show-sidebar-button" class="button square-sm ml0">&gt;|</a></div></div></div></div></div><div class="footer"><div class="panel"><div class="panel-inset m0 text-center"> Copyright © Wube Software <span class="separator">|</span><a href="../license.html">License</a><span class="separator">|</span><a href="../static/archive.zip">Download</a><span class="separator">|</span><a href="https://forums.factorio.com/viewforum.php?f=233" target="_blank">Feedback</a></div></div></div></body></html>